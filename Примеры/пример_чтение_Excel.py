"""
–ü–†–ò–ú–ï–†: –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —á–∏—Ç–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Excel —Ñ–∞–π–ª–∞,
–∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.
"""

from pathlib import Path
from openpyxl import load_workbook


def —á–∏—Ç–∞—Ç—å_–ø–∞—Ä–∞–º–µ—Ç—Ä—ã_—Ä–∞—Å—á–µ—Ç–∞(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É, –ª–∏—Å—Ç="–ü–∞—Ä–∞–º–µ—Ç—Ä—ã"):
    """
    –ß–∏—Ç–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞ –∏–∑ Excel —Ñ–∞–π–ª–∞
    
    Args:
        –ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É: –ü—É—Ç—å –∫ Excel —Ñ–∞–π–ª—É
        –ª–∏—Å—Ç: –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        
    Returns:
        dict: –°–ª–æ–≤–∞—Ä—å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ä–∞—Å—á–µ—Ç–∞
    """
    if not Path(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É).exists():
        print(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É}")
        return None
    
    try:
        # –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—á–µ–π –∫–Ω–∏–≥–∏
        workbook = load_workbook(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É, data_only=True)
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∏—Å—Ç–∞
        if –ª–∏—Å—Ç not in workbook.sheetnames:
            print(f"‚ö†Ô∏è –õ–∏—Å—Ç '{–ª–∏—Å—Ç}' –Ω–µ –Ω–∞–π–¥–µ–Ω. –î–æ—Å—Ç—É–ø–Ω—ã–µ –ª–∏—Å—Ç—ã: {workbook.sheetnames}")
            –ª–∏—Å—Ç = workbook.sheetnames[0]  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç
        
        worksheet = workbook[–ª–∏—Å—Ç]
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        –ø–∞—Ä–∞–º–µ—Ç—Ä—ã = {}
        
        # –ü—Ä–∏–º–µ—Ä —á—Ç–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ —è—á–µ–µ–∫
        # –í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Excel –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω–æ–π
        
        # –°–ø–æ—Å–æ–± 1: –ß—Ç–µ–Ω–∏–µ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —è—á–µ–π–∫–∞–º
        –ø–∞—Ä–∞–º–µ—Ç—Ä—ã["–ù–∞–∑–≤–∞–Ω–∏–µ_–º–æ–¥–µ–ª–∏"] = worksheet["B2"].value or ""
        –ø–∞—Ä–∞–º–µ—Ç—Ä—ã["–°—Ö–µ–º–∞"] = worksheet["B3"].value or ""
        –ø–∞—Ä–∞–º–µ—Ç—Ä—ã["–í—Ä–µ–º—è_—Ä–∞—Å—á–µ—Ç–∞"] = worksheet["B4"].value or 5.0
        
        # –°–ø–æ—Å–æ–± 2: –ß—Ç–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–æ–∫–∞–º —Å –ø–æ–∏—Å–∫–æ–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        for row in worksheet.iter_rows(min_row=1, max_row=20, values_only=False):
            # –ò—â–µ–º —è—á–µ–π–∫–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            if row[0].value and isinstance(row[0].value, str):
                –∫–ª—é—á = row[0].value.strip()
                –∑–Ω–∞—á–µ–Ω–∏–µ = row[1].value if len(row) > 1 else None
                
                if "–ú–æ–¥–µ–ª—å" in –∫–ª—é—á:
                    –ø–∞—Ä–∞–º–µ—Ç—Ä—ã["–ù–∞–∑–≤–∞–Ω–∏–µ_–º–æ–¥–µ–ª–∏"] = –∑–Ω–∞—á–µ–Ω–∏–µ or ""
                elif "–°—Ö–µ–º–∞" in –∫–ª—é—á:
                    –ø–∞—Ä–∞–º–µ—Ç—Ä—ã["–°—Ö–µ–º–∞"] = –∑–Ω–∞—á–µ–Ω–∏–µ or ""
                elif "–í—Ä–µ–º—è" in –∫–ª—é—á and "—Ä–∞—Å—á–µ—Ç–∞" in –∫–ª—é—á:
                    –ø–∞—Ä–∞–º–µ—Ç—Ä—ã["–í—Ä–µ–º—è_—Ä–∞—Å—á–µ—Ç–∞"] = float(–∑–Ω–∞—á–µ–Ω–∏–µ) if –∑–Ω–∞—á–µ–Ω–∏–µ else 5.0
        
        workbook.close()
        
        print(f"‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã –∏–∑ {–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É}")
        return –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: {e}")
        return None


def —á–∏—Ç–∞—Ç—å_–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É, –ª–∏—Å—Ç="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã"):
    """
    –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞—Ö –∏–∑ Excel
    
    Args:
        –ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É: –ü—É—Ç—å –∫ Excel —Ñ–∞–π–ª—É
        –ª–∏—Å—Ç: –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ —Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞–º–∏
        
    Returns:
        list: –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤
    """
    if not Path(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É).exists():
        print(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É}")
        return []
    
    try:
        workbook = load_workbook(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É, data_only=True)
        
        if –ª–∏—Å—Ç not in workbook.sheetnames:
            print(f"‚ö†Ô∏è –õ–∏—Å—Ç '{–ª–∏—Å—Ç}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return []
        
        worksheet = workbook[–ª–∏—Å—Ç]
        –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã = []
        
        # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–∫–∏
        –∑–∞–≥–æ–ª–æ–≤–∫–∏ = []
        for cell in worksheet[1]:
            –∑–∞–≥–æ–ª–æ–≤–∫–∏.append(cell.value if cell.value else "")
        
        # –ß–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–∏
        for row_idx, row in enumerate(worksheet.iter_rows(min_row=2, values_only=False), start=2):
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
            if not row[0].value:
                continue
            
            –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä = {}
            for col_idx, cell in enumerate(row):
                if col_idx < len(–∑–∞–≥–æ–ª–æ–≤–∫–∏):
                    –∫–ª—é—á = –∑–∞–≥–æ–ª–æ–≤–∫–∏[col_idx] or f"–ö–æ–ª–æ–Ω–∫–∞_{col_idx+1}"
                    –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä[–∫–ª—é—á] = cell.value
            
            –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã.append(–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä)
        
        workbook.close()
        
        print(f"‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–æ {len(–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã)} –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤")
        return –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤: {e}")
        return []


def —á–∏—Ç–∞—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏_—Ä–∞—Å—á–µ—Ç–∞(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É):
    """
    –ß–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ –∏–∑ Excel (–∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö)
    
    –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Ö–æ–∂–∞ –Ω–∞ —Ç–æ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ DSS –∏ StabLimit
    
    Args:
        –ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É: –ü—É—Ç—å –∫ Excel —Ñ–∞–π–ª—É
        
    Returns:
        dict: –°–ª–æ–≤–∞—Ä—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    """
    if not Path(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É).exists():
        print(f"‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É}")
        return {}
    
    try:
        workbook = load_workbook(–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É, data_only=True)
        –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ = {}
        
        # –ü—Ä–∏–º–µ—Ä —á—Ç–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤
        # –í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö —ç—Ç–æ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
        
        if "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" in workbook.sheetnames:
            worksheet = workbook["–ù–∞—Å—Ç—Ä–æ–π–∫–∏"]
            
            # –ß–∏—Ç–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
            for row in worksheet.iter_rows(min_row=1, max_row=50):
                if row[0].value and row[1].value:
                    –∫–ª—é—á = str(row[0].value).strip()
                    –∑–Ω–∞—á–µ–Ω–∏–µ = row[1].value
                    
                    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ –Ω—É–∂–Ω—ã–π —Ç–∏–ø
                    if isinstance(–∑–Ω–∞—á–µ–Ω–∏–µ, (int, float)):
                        –Ω–∞—Å—Ç—Ä–æ–π–∫–∏[–∫–ª—é—á] = –∑–Ω–∞—á–µ–Ω–∏–µ
                    elif isinstance(–∑–Ω–∞—á–µ–Ω–∏–µ, str):
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ
                        try:
                            if '.' in –∑–Ω–∞—á–µ–Ω–∏–µ:
                                –Ω–∞—Å—Ç—Ä–æ–π–∫–∏[–∫–ª—é—á] = float(–∑–Ω–∞—á–µ–Ω–∏–µ)
                            else:
                                –Ω–∞—Å—Ç—Ä–æ–π–∫–∏[–∫–ª—é—á] = int(–∑–Ω–∞—á–µ–Ω–∏–µ)
                        except ValueError:
                            –Ω–∞—Å—Ç—Ä–æ–π–∫–∏[–∫–ª—é—á] = –∑–Ω–∞—á–µ–Ω–∏–µ
        
        workbook.close()
        
        print(f"‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã")
        return –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")
        return {}


# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    print("="*60)
    print("–ü–†–ò–ú–ï–†: –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel")
    print("="*60)
    
    # –ü—Ä–∏–º–µ—Ä –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π)
    –ø—É—Ç—å = "–ø—Ä–∏–º–µ—Ä_–¥–∞–Ω–Ω—ã—Ö.xlsx"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
    if not Path(–ø—É—Ç—å).exists():
        print(f"\n‚ö†Ô∏è –§–∞–π–ª {–ø—É—Ç—å} –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        print("–°–æ–∑–¥–∞–π—Ç–µ Excel —Ñ–∞–π–ª —Å –ª–∏—Å—Ç–∞–º–∏:")
        print("  - '–ü–∞—Ä–∞–º–µ—Ç—Ä—ã' - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞")
        print("  - '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã' - –¥–∞–Ω–Ω—ã–µ –æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞—Ö")
        print("  - '–ù–∞—Å—Ç—Ä–æ–π–∫–∏' - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á–µ—Ç–∞")
        print("\n–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.")
    else:
        # –ß—Ç–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        –ø–∞—Ä–∞–º–µ—Ç—Ä—ã = —á–∏—Ç–∞—Ç—å_–ø–∞—Ä–∞–º–µ—Ç—Ä—ã_—Ä–∞—Å—á–µ—Ç–∞(–ø—É—Ç—å)
        if –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
            print("\nüìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞:")
            for –∫–ª—é—á, –∑–Ω–∞—á–µ–Ω–∏–µ in –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.items():
                print(f"  {–∫–ª—é—á}: {–∑–Ω–∞—á–µ–Ω–∏–µ}")
        
        # –ß—Ç–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤
        –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã = —á–∏—Ç–∞—Ç—å_–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã(–ø—É—Ç—å)
        if –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã:
            print(f"\n‚öôÔ∏è –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã (–ø–µ—Ä–≤—ã–π):")
            if –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã:
                for –∫–ª—é—á, –∑–Ω–∞—á–µ–Ω–∏–µ in –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã[0].items():
                    print(f"  {–∫–ª—é—á}: {–∑–Ω–∞—á–µ–Ω–∏–µ}")
        
        # –ß—Ç–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ = —á–∏—Ç–∞—Ç—å_–Ω–∞—Å—Ç—Ä–æ–π–∫–∏_—Ä–∞—Å—á–µ—Ç–∞(–ø—É—Ç—å)
        if –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
            print(f"\n‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏:")
            for –∫–ª—é—á, –∑–Ω–∞—á–µ–Ω–∏–µ in list(–Ω–∞—Å—Ç—Ä–æ–π–∫–∏.items())[:5]:  # –ü–µ—Ä–≤—ã–µ 5
                print(f"  {–∫–ª—é—á}: {–∑–Ω–∞—á–µ–Ω–∏–µ}")

