"""
–ü–†–ò–ú–ï–†: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RasterWin —á–µ—Ä–µ–∑ COM

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ RasterWin —á–µ—Ä–µ–∑ COM API.
–í–ê–ñ–ù–û: –≠—Ç–æ—Ç –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ Windows —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º pywin32 –∏ RasterWin.

–ù–∞ Mac —ç—Ç–æ—Ç –∫–æ–¥ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ª–æ–≥–∏–∫—É.
"""

import sys

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
if sys.platform == 'win32':
    try:
        import win32com.client
        COM_AVAILABLE = True
    except ImportError:
        print("‚ö†Ô∏è pywin32 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install pywin32")
        COM_AVAILABLE = False
else:
    print("‚ö†Ô∏è –≠—Ç–æ—Ç –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ Windows")
    COM_AVAILABLE = False


def –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è_–∫_rastrwin():
    """
    –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ RasterWin —á–µ—Ä–µ–∑ COM API
    
    Returns:
        –û–±—ä–µ–∫—Ç RasterWin –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
    """
    if not COM_AVAILABLE:
        print("‚ùå COM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —ç—Ç–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ")
        return None
    
    try:
        # –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ProgID (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)
        # –≠—Ç–æ —Ç–æ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
        rastr = win32com.client.Dispatch("Astra.Rastr")
        print("‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RasterWin —á–µ—Ä–µ–∑ ProgID")
        return rastr
        
    except Exception as e:
        try:
            # –°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GUID (fallback)
            # GUID –¥–ª—è RasterWin: {EFC5E4AD-A3DD-11D3-B73F-00500454CF3F}
            guid = "{EFC5E4AD-A3DD-11D3-B73F-00500454CF3F}"
            rastr = win32com.client.Dispatch(guid)
            print("‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RasterWin —á–µ—Ä–µ–∑ GUID")
            return rastr
        except Exception as e2:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RasterWin: {e2}")
            return None


def –ø–æ–ª—É—á–∏—Ç—å_–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é_–æ_rastrwin(rastr):
    """
    –ü–æ–ª—É—á–∞–µ—Ç –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–º RasterWin
    
    Args:
        rastr: –û–±—ä–µ–∫—Ç RasterWin
    """
    if rastr is None:
        print("‚ùå RasterWin –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω")
        return
    
    try:
        # –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
        print("\n" + "="*50)
        print("–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û RASTERWIN")
        print("="*50)
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü (–ø—Ä–∏–º–µ—Ä)
        # –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: rastr.Tables.Item("table_name")
        print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ")
        print("–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:")
        print("  - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (load)")
        print("  - –†–∞—Å—á–µ—Ç —Ä–µ–∂–∏–º–∞ (rgm)")
        print("  - –†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ (Tables)")
        
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: {e}")


def –ø—Ä–∏–º–µ—Ä_–∑–∞–≥—Ä—É–∑–∫–∏_—Ñ–∞–π–ª–∞(rastr, –ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É):
    """
    –ü—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –≤ RasterWin
    
    Args:
        rastr: –û–±—ä–µ–∫—Ç RasterWin
        –ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É .rst, .scn –∏ —Ç.–¥.
    """
    if rastr is None:
        print("‚ùå RasterWin –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω")
        return False
    
    try:
        # –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–∞–∫:
        # 1. –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —à–∞–±–ª–æ–Ω (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
        # 2. –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ñ–∞–π–ª
        
        # –ü—Ä–∏–º–µ—Ä (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã):
        # shabl = "–ø—É—Ç—å_–∫_—à–∞–±–ª–æ–Ω—É.rst"  # –®–∞–±–ª–æ–Ω –¥–ª—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
        # rastr.NewFile(shabl)  # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ —à–∞–±–ª–æ–Ω—É
        # rastr.Load(0, –ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É, shabl)  # RG_REPL = 0 (–∑–∞–º–µ–Ω–∞)
        
        print(f"üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞: {–ø—É—Ç—å_–∫_—Ñ–∞–π–ª—É}")
        print("   (–ø—Ä–∏–º–µ—Ä –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω - –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª)")
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: {e}")
        return False


def –ø—Ä–∏–º–µ—Ä_—Ä–∞—Å—á–µ—Ç–∞_—Ä–µ–∂–∏–º–∞(rastr):
    """
    –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–≤—à–µ–≥–æ—Å—è —Ä–µ–∂–∏–º–∞
    
    Args:
        rastr: –û–±—ä–µ–∫—Ç RasterWin
        
    Returns:
        bool: True –µ—Å–ª–∏ —Ä–µ–∂–∏–º —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω, False –∏–Ω–∞—á–µ
    """
    if rastr is None:
        print("‚ùå RasterWin –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω")
        return False
    
    try:
        # –í —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ —Ä–∞—Å—á–µ—Ç —Ä–µ–∂–∏–º–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
        # kod = rastr.rgm("p")  # "p" - —Ä–∞—Å—á–µ—Ç —Å –ø–ª–æ—Å–∫–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
        # is_balanced = kod == 0  # 0 –æ–∑–Ω–∞—á–∞–µ—Ç —É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã rgm():
        # "" - —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        # "p" - —Ä–∞—Å—á–µ—Ç —Å –ø–ª–æ—Å–∫–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
        # "z" - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
        # "c" - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–∞–Ω–Ω—ã—Ö
        # "r" - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        
        print("\nüìä –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–≤—à–µ–≥–æ—Å—è —Ä–µ–∂–∏–º–∞...")
        print("   (–ø—Ä–∏–º–µ—Ä –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω - –Ω—É–∂–µ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª)")
        
        # –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω):
        # kod = rastr.rgm("p")
        # if kod == 0:
        #     print("‚úÖ –†–µ–∂–∏–º —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω!")
        #     return True
        # else:
        #     print("‚ùå –†–µ–∂–∏–º –Ω–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω!")
        #     return False
        
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–µ–∂–∏–º–∞: {e}")
        return False


# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–¥–ª—è Windows)
if __name__ == "__main__":
    print("="*60)
    print("–ü–†–ò–ú–ï–†: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RasterWin —á–µ—Ä–µ–∑ COM")
    print("="*60)
    
    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RasterWin
    rastr = –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è_–∫_rastrwin()
    
    if rastr:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        –ø–æ–ª—É—á–∏—Ç—å_–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é_–æ_rastrwin(rastr)
        
        # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤)
        # –ø—Ä–∏–º–µ—Ä_–∑–∞–≥—Ä—É–∑–∫–∏_—Ñ–∞–π–ª–∞(rastr, "C:/–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.rst")
        # –ø—Ä–∏–º–µ—Ä_—Ä–∞—Å—á–µ—Ç–∞_—Ä–µ–∂–∏–º–∞(rastr)
        
        print("\n" + "="*60)
        print("‚úÖ –ü—Ä–∏–º–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
        print("="*60)
    else:
        print("\n‚ö†Ô∏è –ü—Ä–∏–º–µ—Ä –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω - COM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ RasterWin –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        print("–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –Ω–∞ Mac. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ Windows —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º RasterWin.")

